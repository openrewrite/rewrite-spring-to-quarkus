#
# Copyright 2025 the original author or authors.
# <p>
# Licensed under the Moderne Source Available License (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://docs.moderne.io/licensing/moderne-source-available-license
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.quarkus.spring.MigrateSpringActuator
displayName: Migrate Spring Boot Actuator to Quarkus Health and Metrics
description: >-
  Migrates Spring Boot Actuator to Quarkus SmallRye Health and Metrics extensions.
  Converts HealthIndicator implementations to Quarkus HealthCheck pattern.
tags:
  - spring
  - quarkus
  - actuator
  - health
  - metrics
  - migration
recipeList:
  # Replace actuator dependency with SmallRye extensions
  - org.openrewrite.java.dependencies.ChangeDependency:
      oldGroupId: org.springframework.boot
      oldArtifactId: spring-boot-starter-actuator
      newGroupId: io.quarkus
      newArtifactId: quarkus-smallrye-health
      newVersion: x
  # Add metrics extension
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-micrometer
      version: x
      onlyIfUsing: io.micrometer.core.instrument.*
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-micrometer-registry-prometheus
      version: x
      onlyIfUsing: io.micrometer.core.instrument.*
  # Convert HealthIndicator to HealthCheck
  - org.openrewrite.quarkus.spring.SpringHealthIndicatorToQuarkus
  # Update actuator property names
  - org.openrewrite.properties.ChangePropertyKey:
      oldPropertyKey: management.endpoints.web.exposure.include
      newPropertyKey: quarkus.smallrye-health.root-path
  - org.openrewrite.properties.ChangePropertyKey:
      oldPropertyKey: management.endpoint.health.show-details
      newPropertyKey: quarkus.smallrye-health.ui.always-include
  - org.openrewrite.properties.ChangePropertyKey:
      oldPropertyKey: management.server.port
      newPropertyKey: quarkus.management.port
